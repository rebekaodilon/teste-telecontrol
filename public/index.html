<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Telecontrol - Login / Registro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5" style="max-width:720px">
  <h1 class="h4 mb-4 text-center">Telecontrol — Acesso</h1>
  <ul class="nav nav-tabs" id="tab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">Login</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab">Registro</button>
    </li>
  </ul>
  <div class="tab-content card card-body">
    <div class="tab-pane fade show active" id="login" role="tabpanel">
      <div class="mb-2">
        <label class="form-label">Email</label>
        <input id="login-email" class="form-control" value="admin@admin.com">
      </div>
      <div class="mb-2">
        <label class="form-label">Senha</label>
        <input id="login-password" class="form-control" type="password" value="123456">
      </div>
      <button id="btn-login" class="btn btn-primary w-100">Entrar</button>
    </div>
    <div class="tab-pane fade" id="register" role="tabpanel">
      <div class="mb-2"><label class="form-label">Nome</label><input id="reg-name" class="form-control"></div>
      <div class="mb-2"><label class="form-label">Email</label><input id="reg-email" class="form-control"></div>
      <div class="mb-2"><label class="form-label">Senha</label><input id="reg-password" class="form-control" type="password"></div>
      <button id="btn-register" class="btn btn-success w-100">Criar conta</button>
      <small class="text-muted d-block mt-2">Ao registrar, você será autenticada automaticamente.</small>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="assets/app.js"></script>
<script>
  if (getToken()) window.location.href = '/clients.html';
  $('#btn-login').on('click', function(){
    api('/api/login','POST',{email: $('#login-email').val(), password: $('#login-password').val()})
      .then(res => { console.log('Resposta do login:', res); setToken(res.token); window.location.href = '/clients.html'; })
      .catch(err => alert(err.error || 'Erro no login'));
  });
  $('#btn-register').on('click', function(){
    api('/api/register','POST',{name: $('#reg-name').val(), email: $('#reg-email').val(), password: $('#reg-password').val()})
      .then(res => { setToken(res.token); window.location.href = '/clients.html'; })
      .catch(err => alert(err.error || 'Erro no registro'));
  });
</script>
</body>
</html>
